!function(){function set(str,value){for(var p,cur=VARS.source,ps=str.split("."),ks=[],fns="",i=0,len=ps.length;len>i;i++)p=ps[i],cur=cur[p],ks.push('["'+ps[i]+'"]');fns="VARS.source"+ks.join("")+'="'+value+'"',eval("("+fns+")")}function get(e){for(var o=VARS.source,i=e.split("."),t=0,n=i.length;n>t;t++)if(o=o[i[t]],void 0===o)return;return o}for(var VARS={prefix:"$",keys:["SYS","ROOM","PAGE"],source:{},scope:window},i=0;i<VARS.keys.length;i++){var key=VARS.keys[i],fkey=VARS.prefix+key,obj=VARS.scope[fkey];obj&&(VARS.source[key.toLowerCase()]=obj)}define("dypassport/context",["shark/util/cookie/1.0"],function(e){location.host;e.config("keypre",get("sys.cookie_pre")||"");var o={set:set,get:get};return o})}(),shark.config({resolve:function(e){if(shark.helper.file.isAbsolute(e))return!1;var o=e.split("/"),i=o[0],t=shark.helper.file.isCss(e)?"css/":"js/";switch(i){case"dypassport":e="app/douyu-passport/"+t+o.slice(1).join("/");break;case"dypassport-activity":e="app/douyu-passport/activity/"+t+o.slice(1).join("/")}return e}}),shark.on("createNode",function(e,o){var i,t=shark.helper.file,n="2.0.37";i=o.url,t.isCss(i)?i.indexOf("?")>0?e.href=i+"&"+n:e.href=i+"?"+n:i.indexOf("?")>0?e.src=i+"&"+n:e.src=i+"?"+n}),shark.on("saved",function(e){var o=new RegExp("^dypassport//*");o.test(e.id)&&shark.helper.domReady(function(){define([e.id],function(e){e&&"function"==typeof e.application&&e.application.call(e)})})}),define("dypassport/com/verify/verify",["jquery","shark/class","dypassport/com/verify/geetestV3","dypassport/com/verify/geetestV4","dypassport/com/verify/imgCode","dypassport/com/verify/vcode9"],function(e,o,i,t,n,a){var s=o({init:function(o){this.options=e.extend(!0,{},o),this.verifyData={},this.check()},check:function(){if(!this.loading){var o=this,i=o.options.xhrParams||{};this.loading=!0,e(".refresh-code").addClass("disabled"),e.ajax(i.url,{type:"post",data:i.data||{},dataType:"json",timeout:5e3,success:function(t){if(o.loading=!1,e(".refresh-code").removeClass("disabled"),t&&0===+t.error&&t.data){var n=t.data||{};if(o.instance){if(o.verifyData.code_type===n.code_type)return o.instance.renderVerity(n.code_data),void(o.verifyData.code_token=n.code_token);o.instance.destroy(),o.instance=null}o.verifyData.code_type=n.code_type,o.verifyData.code_token=n.code_token,o.build(n)}else e.dialog.tips_black(t.msg||"网络错误"),e.isFunction(i.errorHandle)&&i.errorHandle()},error:function(){o.loading=!1,e(".refresh-code").removeClass("disabled"),e.dialog.tips_black("网络错误，验证码加载失败"),e.isFunction(i.errorHandle)&&i.errorHandle()}})}},build:function(o){var s=this,r=s.options.xhrParams,c=o.code_data||o||{},l=s.options.options,d=s.options.otherFunctions||{},p={success:s.options.success||e.noop,error:s.options.error||e.noop,close:s.options.close||e.noop,init:d.init||e.noop,"catch":d["catch"]||e.noop,refresh:d.refresh||e.noop,destroy:d.destroy||e.noop,onNextWillShow:d.onNextWillShow||e.noop};switch(+o.code_type){case 1:r.data&&"v4"===r.data.gt_version?this.instance=t.create(l,c,p):this.instance=i.create(l,c,p);break;case 2:this.instance=n.create(l,c,p,function(){s.check(),p.refresh()});break;case 3:this.instance=a.create(l,c,p,function(){s.check(),p.refresh()})}}});return s}),define("dypassport/com/verify/geetestV3",["jquery","shark/class"],function(e,o){var i=o({init:function(e,o,i){this.options=e||{},this.functions=i||{},this.buildAsync(o)},render:function(){this.geeId=Math.random().toString(36).substring(2),this.options.target.addClass("render").append('<div id="'+this.geeId+'"></div>')},buildAsync:function(e){var o=this,i=location.protocol;require.use([i+"//static.geetest.com/static/tools/gt.js"],function(){o.render(),o.build(e)})},build:function(o){var i=this,t=i.functions.success||e.noop,n=i.functions.error||e.noop,a=(i.functions.close||e.noop,i.functions.init||e.noop),s=i.functions["catch"]||e.noop,r=i.functions.refresh||e.noop,c=i.functions.destroy||e.noop;delete i.options.target,delete i.options.v9Area,delete i.options.shadow;var l=e.extend(!0,{product:"custom",width:"100%",area:"body",next_width:"260px",bg_color:"transparent"},i.options,o||{});try{window.initGeetest(l,function(e){a();var o=null;i.getResult=function(){return o},i.refresh=function(){o=null,r(),e.reset()},i.destroy=function(){o=null,c(),e.destroy()},e.appendTo("#"+i.geeId),e.onSuccess(function(){o=e.getValidate(),t(o)}),e.onError(function(){o=null,n()})})}catch(d){s()}}}),t={create:function(e,o,t){return new i(e,o,t)}};return t}),!function(e,o){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?o(e,!0):function(e){if(!e.document)throw new Error("Geetest requires a window with a document");return o(e)}:o(e)}("undefined"!=typeof window?window:this,function(e,o){"use strict";function i(e){this._obj=e}function t(e){var o=this;new i(e)._each(function(e,i){o[e]=i})}if(void 0===e)throw new Error("Geetest requires browser environment");var n=e.document,a=e.Math,s=n.getElementsByTagName("head")[0];i.prototype={_each:function(e){var o=this._obj;for(var i in o)o.hasOwnProperty(i)&&e(i,o[i]);return this}},t.prototype={api_server:"api.geetest.com",type_path:"/gettype_deepknow.php",protocol:"http://",static_servers:["static.geetest.com","dn-staticdown.qbox.me"],path:"/static/js/sense.js",type:"sense",_extend:function(e){var o=this;new i(e)._each(function(e,i){o[e]=i})}};var r=function(e){return"number"==typeof e},c=function(e){return"string"==typeof e},l=function(e){return"boolean"==typeof e},d=function(e){return"function"==typeof e},p=function(){return parseInt(1e4*a.random())+(new Date).valueOf()},u=function(e,o){var i=n.createElement("script");i.charset="UTF-8",i.async=!0,i.onerror=function(){o(!0)};var t=!1;i.onload=i.onreadystatechange=function(){t||i.readyState&&"loaded"!==i.readyState&&"complete"!==i.readyState||(t=!0,setTimeout(function(){o(!1)},0))},i.src=e,s.appendChild(i)},f=function(e){return e.replace(/^https?:\/\/|\/$/g,"")},h=function(e){return e=e.replace(/\/+/g,"/"),0!==e.indexOf("/")&&(e="/"+e),e},g=function(e){if(!e)return"";var o="?";return new i(e)._each(function(e,i){(c(i)||r(i)||l(i))&&(o=o+encodeURIComponent(e)+"="+encodeURIComponent(i)+"&")}),"?"===o&&(o=""),o.replace(/&$/,"")},v=function(e,o,i,t){o=f(o);var n=h(i)+g(t);return o&&(n=e+o+n),n},y=function(e,o,i,t,n){var a=function(s){var r=v(e,o[s],i,t);u(r,function(e){e?s>=o.length-1?n(!0):a(s+1):n(!1)})};a(0)},m=function(o,i,t,n){var a="geetest_"+p();e[a]=function(o){n("success"===o.status?o.data:o),e[a]=void 0;try{delete e[a]}catch(i){}},y(t.protocol,o,i,{gt:t.id,callback:a},function(e){e&&w("networkError",t)})},w=function(e,o){var i={networkError:"网络错误",idNotExist:"参数id必填",cbIlegal:"callback必须是function",geetestNotExist:"Geetest不存在"};if("function"!=typeof o.onError)throw new Error(i[e]);o.onError(i[e])},b=function(){return!!e.Geetest},_=function(o,i){var n=new t(o);return o.https?n.protocol="https://":"http:"!==e.location.protocol&&"https:"!==e.location.protocol?n.protocol="https://":n.protocol=e.location.protocol+"//",o&&o.id?i&&!d(i)?void w("cbIlegal",n):b()?void(i&&i(new e.Geetest(n))):void m([n.api_server],n.type_path,n,function(o){y(n.protocol,o.static_servers,o.path,null,function(t){if(t)w("networkError",n);else{if("undefined"==typeof e.Geetest)return void w("geetestNotExist",n);n._extend(o),i&&i(new e.Geetest(n))}})}):void w("idNotExist",n)};return e.initSense=_,_}),define("dypassport/com/verify/geetestV4",["jquery","shark/class"],function(e,o){var i=o({init:function(e,o,i){this.options=e||{},this.functions=i||{},this.build(o)},build:function(o){var i=this,t=i.options.infos||{},n=(i.functions.show||e.noop,i.functions.success||e.noop),a=i.functions.error||e.noop,s=i.functions.close||e.noop,r=i.functions.init||e.noop,c=i.functions["catch"]||e.noop,l=i.functions.refresh||e.noop,d=i.functions.onNextWillShow||e.noop;delete i.options.target,delete i.options.v9Area,delete i.options.shadow;var p=e.extend(!0,{https:!0,width:"260px",area:"body",bg_color:"transparent"},i.options,o||{});try{console.time("start"),window.initSense(p,function(e){r(),console.timeEnd("start");var o=null;i.getResult=function(){return o},i.show=function(){e.sense()},i.refresh=function(){o=null,l(),e.reset()},e.setInfos(function(){return t}).onNextWillShow(function(){d()}).onSuccess(function(e){o=e,o.id=p.id,n(o),i.getResult=function(){return o}}).onClose(function(){s()}).onError(function(e){a(e)})})}catch(u){c()}}}),t={create:function(e,o,t){return new i(e,o,t)}};return t}),define("dypassport/com/verify/vcode9",["jquery","shark/class"],function(e,o){var i=[[0,0],[-55,0],[-110,0],[0,-40],[-55,-40],[-110,-40],[0,-80],[-55,-80],[-110,-80]],t=['<div class="vcode9">','<div class="vcode9-tit clearfix">',"<h3>验证码</h3>",'<a href="javascript:;" class="vcode9-close">关闭</a>',"</div>",'<div class="vcode9-con">','<div class="vcode9-preview clearfix">',"<span>验证码</span>","<b></b><b></b><b></b><b></b>",'<b class="p-delete" title="清除"></b>',"</div>",'<div class="vcode9-guide">',"<span></span>",'<a class="refresh-code" href="javascript:;">看不清？</a>',"</div>",'<div class="vcode9-action">点击框内文字输入验证码</div>','<div class="vcode9-input clearfix">','<a class="i-0" href="javascript:;"><b data-num="0"></b></a>','<a class="i-1" href="javascript:;"><b data-num="1"></b></a>','<a class="i-2" href="javascript:;"><b data-num="2"></b></a>','<a class="i-3" href="javascript:;"><b data-num="3"></b></a>','<a class="i-4" href="javascript:;"><b data-num="4"></b></a>','<a class="i-5" href="javascript:;"><b data-num="5"></b></a>','<a class="i-6" href="javascript:;"><b data-num="6"></b></a>','<a class="i-7" href="javascript:;"><b data-num="7"></b></a>','<a class="i-8" href="javascript:;"><b data-num="8"></b></a>',"</div>","</div>","</div>"].join(""),n=o({init:function(o,i,t,n){var a={title:"验证码",auto:!1,lock:!0,shadow:{opacity:.7}};this.options=e.extend(!0,a,o||{}),this.functions=t||{},this.refresh=n||e.noop;try{this.render(),this.bindEvt(),this.options.auto&&this.show(),this.renderVerity(i)}catch(s){var r=t["catch"]||e.noop;r()}},render:function(){var o=this.make(),i=this.options.v9Area,t=this.options.area,n=e(i||t||"body");this.options.$pop=e(o.pop),this.options.$shadow=e(o.shadow),this.options.$pop.hide().removeClass("hide"),this.options.$shadow.hide().removeClass("hide"),t&&(this.options.$pop.css("position","absolute"),this.options.$shadow.css("position","absolute")),this.options.$pop.find(".vcode9-tit h3").text(this.options.title),this.options.$shadow.css({opacity:this.options.shadow.opacity,filter:"Alpha(Opacity="+100*this.options.shadow.opacity+")"}),n.append(this.options.$pop),n.append(this.options.$shadow),this.options._is_show=!1,this.options.selected=[]},make:function(){return{pop:t,shadow:'<div class="vcode9-shadow hide"></div>'}},show:function(){var o=this;this.options.lock&&this.options.$shadow.fadeIn(),this.options.$pop.fadeIn(function(){var i=o.functions.init||e.noop;o.options._is_show=!0,i.call(o)})},hide:function(){var o=this;this.options.lock&&this.options.$shadow.fadeOut(),this.options.$pop.fadeOut(function(){var i=o.functions.close||e.noop;o.options._is_show=!1,i.call(o)})},getResult:function(){for(var e=this.options.selected,o="",i=0,t=e.length;t>i;i++)o+=e[i].v;return{code:o}},pushCode:function(o){var i=this.options.selected.length,t=this.options.$pop.find(".vcode9-preview > b").not(".p-delete");if(!(i>=4)&&(this.options.selected.push(o),t.eq(i).css({"background-position-x":o.x+"px ","background-position-y":o.y+"px ","background-position":o.x+"px "+o.y+"px"}),i=this.options.selected.length,4===i)){var n=this.functions.success||e.noop;this.hide(),n.call(this,{code:this.getResult()})}},popCode:function(){var e=this.options.selected.length,o=this.options.$pop.find(".vcode9-preview>b").not(".p-delete");e&&(this.options.selected.pop(),o.eq(e-1).css({"background-position":"-500px -500px"}))},destroy:function(){this.options.$pop.remove(),this.options.$shadow.remove();var o=this.functions.destroy||e.noop;o()},renderVerity:function(e){var o="";e&&e.base64_data&&(o="data:image/jpeg;base64,"+e.base64_data);var i=this.options.$pop,t=i.find(".vcode9-preview > b").not(".p-delete"),n="url("+o+")";this.options.selected=[],i.find(".vcode9-preview>b").not(".p-delete").css("background-image",n),i.find(".vcode9-guide>span").css("background-image",n),i.find(".vcode9-input>a>b").css("background-image",n),t.css("background-position","-500px -500px")},bindEvt:function(){function o(e){e.stopPropagation(),e.preventDefault()}var t=this;this.options.$pop.find(".p-delete").click(function(){t.popCode()}),this.options.$pop.find(".vcode9-input > a").click(function(n){o(n);var a,s,r,c=e(this),l=c.find("b"),d=parseInt(l.data("num"))||0;a=i[d],s=a[0]-3,r=a[1]-3,t.pushCode({v:d,x:s,y:r})}),this.options.$pop.find(".vcode9-close").click(function(){return t.hide(),!1}),this.options.$pop.find(".vcode9-guide > a").click(function(){return t.refresh(),!1})}}),a={create:function(e,o,i,t){return new n(e,o,i,t)}};return a}),define("dypassport/com/verify/imgCode",["jquery","shark/class"],function(e,o){var i=o({init:function(o,i,t,n){this.options=e.extend(!0,{},{target:null},o),this.refresh=n||e.noop,this.functions=t||{};try{this.renderVerity(i),this.bindEvt()}catch(a){var s=t["catch"]||e.noop;s()}},renderVerity:function(o){var i="";o&&o.base64_data&&(i="data:image/jpeg;base64,"+o.base64_data),this.options.$tar=e(this.options.target),this.options.$tar.addClass("render").empty().append(['<span class="verify-imgCode-span"></span>','<input class="verify-imgCode-input" type="text" name="captcha_word" maxlength="4" placeholder="获取验证码">','<img class="verify-imgCode-img" src='+i+" >"].join("")),this.options.$ipt=this.options.$tar.find("input"),this.options.$img=this.options.$tar.find("img")},onShow:function(){this.options.$tar.show();var o=this.functions.init||e.noop;o()},onHide:function(){this.options.$tar.hide();var o=this.functions.close||e.noop;o()},getResult:function(){return{code:this.options.$ipt.val()}},bindEvt:function(){var e=this;e.options.$tar.on("click","img",function(o){o.stopPropagation(),o.preventDefault(),e.refresh()})}}),t={create:function(e,o,t,n){return new i(e,o,t,n)}};return t}),define("dypassport/com/user-control",["jquery","shark/util/lang/1.0","shark/util/cookie/1.0","shark/util/flash/bridge/1.0","shark/ext/swfobject"],function(e,o,i,t,n){var a=({client_id:window.client_id||1,hmac_flash_ready:!1,salt:null},{});return a.control={},a.control.API={auth:function(o,i,t){i=i||e.noop,t=t||e.noop,e.ajax({url:passport_host+"iframe/auth",type:"GET",data:o,dataType:"jsonp",jsonp:"callback",callback:"json_callback",success:i,error:t})},iframeLogin:function(o,i,t){i=i||e.noop,t=t||e.noop,$SYS.lang&&(o.lang=$SYS.lang),e.ajax({url:"/iframe/loginNew",type:"post",data:o,dataType:"json",success:i,error:t})},cpsReward:function(o,i,t){i=i||e.noop,t=t||e.noop,e.ajax({url:"/api/cpsReward",type:"GET",data:o,dataType:"json",success:i,error:t})},login:function(o,i,t){i=i||e.noop,t=t||e.noop,e.ajax({url:"/api/passport/login",type:"GET",data:o,dataType:"json",success:i,error:t})},reg:function(o,i,t){i=i||e.noop,t=t||e.noop,e.ajax("/member/register/ajax_new",{type:"post",data:o,dataType:"json",success:i,error:t})},iframeReg:function(o,i,t){i=i||e.noop,t=t||e.noop,$SYS.lang&&(o.lang=$SYS.lang),e.ajax({url:"/iframe/registerNew",type:"post",data:o,dataType:"json",success:i,error:t})},subSiteLogin:function(o,i,t,n){o&&(t=t||e.noop,n=n||e.noop,e.ajax({url:o,type:"GET",data:i,dataType:"jsonp",jsonp:"callback",callback:"json_callback",success:t,error:n}))},qrGenerateCode:function(o,i,t){i=i||e.noop,t=t||e.noop,e.ajax("/scan/generateCode",{type:"post",data:o,dataType:"json",success:i,error:t})},qrCheckScan:function(o,i,t){var n=(new Date).getTime();i=i||e.noop,t=t||e.noop,e.ajax({url:"/lapi/passport/qrcode/check?time="+n,type:"GET",data:o,dataType:"json",success:i,error:t})},qrDeleteCode:function(o,i,t){i=i||e.noop,t=t||e.noop,e.ajax("/scan/deleteCode ",{type:"post",data:o,dataType:"json",success:i,error:t})},getCPS:function(o,i,t){i=i||e.noop,t=t||e.noop,e.ajax({url:"/member/register/getCpsId?v="+(new Date).getTime(),type:"GET",data:o,dataType:"json",success:i,error:t})},checkUserStatus:function(o,i,t){o=o||{},i=i||e.noop,t=t||e.noop,e.ajax({url:"/member/cp/phone_anchor_status",type:"GET",data:o,dataType:"json",success:i,error:t})},checkNickName:function(o,i,t){o=o||{},i=i||e.noop,t=t||e.noop,$SYS.lang&&(o.lang=$SYS.lang),e.ajax({url:"/api/nicknameCheck",type:"post",data:o,dataType:"json",success:i,error:t})},verifyPhone:function(o,i,t){i=i||e.noop,t=t||e.noop,$SYS.lang&&(o.lang=$SYS.lang),e.ajax("/user/bindphone/sendPhoneVoice",{type:"post",data:o,dataType:"json",success:i,error:t})},bindPhone:function(o,i,t){i=i||e.noop,t=t||e.noop,$SYS.lang&&(o.lang=$SYS.lang),e.ajax("/user/bindphone/bindPhone",{type:"post",data:o,dataType:"json",success:i,error:t})},loginVerifyPhone:function(o,i,t){i=i||e.noop,t=t||e.noop,e.ajax("/iframe/loginCaptcha",{type:"post",data:o,dataType:"json",success:i,error:t})},regVerifyPhone:function(o,i,t){i=i||e.noop,t=t||e.noop,e.ajax("/iframe/registerCaptcha",{type:"post",data:o,dataType:"json",success:i,error:t})},regByPhone:function(o,i,t){i=i||e.noop,t=t||e.noop,e.ajax({url:"/iframe/register",type:"post",data:o,dataType:"json",success:i,error:t})},submitNickname:function(o,i,t){i=i||e.noop,t=t||e.noop,e.ajax({url:"/iframe/updateNickname",type:"post",data:o,dataType:"json",success:i,error:t})},getUserInfo:function(o,i,t,n){t=t||e.noop,n=n||e.noop,e.ajax({url:o,type:"get",data:i,dataType:"jsonp",jsonp:"callback",timeout:2e3,callback:"json_callback",success:t,error:n})},getPcCode:function(o,i,t,n){t=t||e.noop,n=n||e.noop,e.ajax({url:o,type:"get",data:i,dataType:"jsonp",jsonp:"callback",timeout:2e3,async:!1,crossDomain:!0,callback:"json_callback",success:t,error:n})},useClentCodeToLogin:function(o,i,t){i=i||e.noop,t=t||e.noop,e.ajax({url:"/lapi/passport/pcAuth/check",type:"get",data:o,dataType:"json",success:i,error:t})}},a.control}),define("dypassport/com/user-view-common",["jquery","shark/util/cookie/1.0"],function(e,o){var i={init:function(){if(e.fn.placeholder&&e("input[placeholder], textarea[placeholder]").each(function(){e(this).placeholder()}),e.dialog.tips_black&&e.dialog.through)try{var i=e.dialog.tips_black;e.dialog.tips_black=function(o,i){var t={},n=e(".loginbox-con");n.size()>0&&(t.left=n.offset().left+90,t.top=n.offset().top+140);var a={id:"Tips",zIndex:e.dialog.defaults.zIndex,title:!1,cancel:!1,fixed:!0,lock:!1,padding:0,margin:0},i=3;return a=e.extend(!0,a,t),e.dialog.through(a).content('<div class="infodrmation">'+o+"</div>").time(i)}}catch(t){e.dialog.tips_black=i}try{window.SMSdk&&SMSdk.getDeviceId&&o.set("sm_did",encodeURIComponent(SMSdk.getDeviceId()),864e5)}catch(t){}window.return_loadhmOk=function(){hmac_flash_ready=!0}}};return i}),define("dypassport/com/dp-base",["jquery","shark/observer"],function(e,o){function i(o,i){n.ext&&(n.ext={});var t=e.extend(!0,{},n,{action_code:i,ext:o});return t}function t(e,o,t){var n=i(e,o);t?DYS.sub({kernelFlag:!0,realTime:!0},n):DYS.sub(n)}var n={};return o.on("dys.com.dpdata",function(e){n=e||{};try{DYS.sub.setPageCode(n.page_code)}catch(o){}}),window.DYS?t:e.noop}),define("dypassport/com/dp-login",["jquery","shark/observer","dypassport/com/dp-base"],function(e,o,i){var t={"dys.login.entry":function(e){var o=e.loginType,t={"login-by-nickname":"click_login_nickname","login-by-phoneNum":"click_login_phonelogin","login-by-sms":"click_login_fastphone"},n=t[o];"login-by-phoneNum"!==o&&delete e.type,delete e.loginType,i(e,n)},"dys.login.input.change":function(e){var o=e.inputType,t=e.loginType,n={phoneNum:{"login-by-phoneNum":"click_login_phonelogin_number","login-by-sms":"click_login_fastphone_number"},password:{"login-by-nickname":"click_login_nickname_pw","login-by-phoneNum":"click_login_phonelogin_pw"},username:{"login-by-nickname":"click_login_nickname_name"},phoneCaptcha:{"login-by-sms":"click_login_fastphone_codein"}},a=n[o][t];"phoneCaptcha"!==o&&delete e.v_type,delete e.inputType,delete e.loginType,i(e,a)},"dys.login.limitcode.succ":function(e){var o=e.loginType,t={"login-by-nickname":"show_login_nickname_limitcode_succ","login-by-phoneNum":"show_login_phonelogin_limitcode_succ","login-by-sms":"show_login_fastphone_limitcode_succ"},n=t[o];delete e.loginType,i(e,n)},"dys.login.limitcode.fail":function(e){var o=e.loginType,t={"login-by-nickname":"show_login_nickname_limitcode_fail","login-by-phoneNum":"show_login_phonelogin_limitcode_fail","login-by-sms":"show_login_fastphone_limitcode_fail"},n=t[o];delete e.loginType,i(e,n)},"dys.login.tologin":function(e){var o=e.loginType,t={"login-by-nickname":"click_login_nickname_tologin","login-by-phoneNum":"click_login_phonelogin_tologin","login-by-sms":"click_login_fastphone_tologin"},n=t[o];delete e.loginType,i(e,n)},"dys.login.succ":function(e){var o=e.loginType,t={"login-by-nickname":"show_login_nickname_succ","login-by-phoneNum":"show_login_phonelogin_succ","login-by-sms":"show_login_fastphone_succ"},n=t[o];delete e.loginType,i(e,n,!0)},"dys.login.fail":function(e){var o=e.loginType,t={"login-by-nickname":"show_login_nickname_fail","login-by-phoneNum":"show_login_phonelogin_fail","login-by-sms":"show_login_fastphone_fail"},n=t[o];delete e.loginType,i(e,n)},"dys.login.fastphone.getcode":function(e){i(e,"click_login_fastphone_get_code")},"dys.login.thirds":function(e){i(e,"click_login_other",!0)},"dys.login.autoreg":function(e){i(e,"click_sign_phones_succ_login")},"dys.login.qrcode.toqrcode":function(e){i(e,"click_login_qrcodelogin")},"dys.login.qrcode.refresh":function(e){i(e,"click_login_qrcodelogin_refresh")},"dys.login.qrcode.succ":function(e){i(e,"show_qrcodelogin_succ")},"dys.login.qrcode.fail":function(e){i(e,"show_qrcodelogin_fail")},"dys.login.verify.show":function(e){i(e,"show_login_remote_verify")},"dys.login.verify.code":function(e){i(e,"click_login_remote_code")},"dys.login.verify.confirm":function(e){i(e,"click_login_remote_code_confirm")},"dys.login.verify.cancel":function(e){i(e,"click_login_remote_code_cancel")},"dys.login.verify.succ":function(e){i(e,"show_login_remote_code_succ")},"dys.login.verify.fail":function(e){i(e,"show_login_remote_code_fail")},"dys.login.verify.other":function(e){i(e,"click_login_remote_other")},"dys.login.verify.qa.back":function(e){i(e,"click_sequestion_back")},"dys.login.verify.qa.confirm":function(e){i(e,"click_sequestion_confirm")},"dys.login.verify.qa.succ":function(e){i(e,"	show_sequestion_succ")},"dys.login.verify.qa.fail":function(e){i(e,"show_sequestion_fail")},"dys.login.show":function(e){i(e,"show_login",!0)},"dys.login.click_phone_country":function(e){i(e,"click_login_phone_country")},"dys.login.click_code":function(e){i(e,"click_login_code",!0)},"dys.login.password.forget":function(e){i(e,"click_login_forgpass",!0)},"dys.login.notReg.showTip":function(e){i(e,"show_login_fastphone_phnooccupy")},"dys.login.nickname.succ":function(e){i(e,"show_login_nickname_succ")}};for(var n in t)!function(e){var i=t[e];o.on(e,function(e){i.call(this,e)})}(n)}),define("dypassport/com/location-log-verify",["jquery","shark/class","shark/util/lang/1.0","shark/util/template/1.0","shark/observer","dypassport/com/dp-login","dypassport/com/user-control","dypassport/com/location-verify-qa"],function(e,o,i,t,n,a,s,r){var c={v_type:"mes",verifyType:1,logBox:e("#loginbox-con"),CALLBACK:{login:"passport_login_callback"},client_id:window.client_id||1},l={remoteLogin:function(o,i,t){i=i||e.noop,t=t||e.noop,$SYS.lang&&(o.lang=$SYS.lang),e.ajax({url:"/iframe/remoteLogin",type:"post",data:o,dataType:"json",success:i,error:t})},sendPhoneCaptcha:function(o,i,t){var n=1===+c.verifyType?"/iframe/sendPhoneCaptcha":"/iframe/sendEmail";i=i||e.noop,t=t||e.noop,$SYS.lang&&(o.lang=$SYS.lang),e.ajax({url:n,type:"post",data:o,dataType:"json",success:i,error:t})}},d={getLocationParam:function(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(o);return null!=i?decodeURIComponent(i[2]):null}},p=function(o){var i="";try{i=e.i18n.prop(o)}catch(t){}return i},u=o({init:function(o){var i=this;if(i.options=e.extend({},{phonenum:".js-verify-phonenum",iptcode:".js-verify-iptcode",voicebtn:".js-verify-voicebtn",submit:".js-verify-submit",cancel:".js-verify-cancel",close:".js-verify-close",info:".js-verify-info",onSubmit:e.noop,onCancel:e.noop,data:{isForeignTel:0,hidePhone:"",hideEmail:"",securityQuiz:""}},o||{}),i.voicetext="短信验证",i.isoutside=!1,i.countTimer=null,i.sendvoicetime=0,1===parseInt(i.options.data.isForeignTel,10)){var t=window.$SYS?window.$SYS.foreign_captcha_type:2,n=1===+t?"语音":"短信";i.voicetext=n+"验证",i.isoutside=1===+t}i.show(),i.getDoms(),i.options.data.securityQuiz&&r.init({data:i.options.data.securityQuiz||""}),i.bindEvt()},render:function(e){var o,n,a=i.string.join('<div class="location-verify-wrap" id="location-verify-wrap">','<div class="location-verify-mask"></div>','<div class="location-verify-content">','<h3 class="location-verify-title">登录验证</h3>','<div class="location-verify-close js-verify-close" data-verify="close">&times</div>','<div class="location-verify-bd js-location-verify-bd">','<div class="location-verify-tip">为了保证您的帐号安全，本次登录需进行安全信息验证</div>','<div class="location-verify-tip location-verify-phone" data-verify="phone-number">','<span class="location-verify-type">验证方式：</span>','<span class="location-verify-type-value">',"<% if (hideEmail) { %>",'<div class="location-verify-select js-location-verify-select">','<span class="location-verify-select-arrow"></span>','<div class="location-verify-select-value js-location-verify-select-value" title="">手机验证（<%= hidePhone %>）</div>','<ul class="location-verify-select-list js-location-verify-select-list">','<li class="location-verify-select-item js-location-verify-select-item" title="<%= hidePhone %>" data-verify-type="1" data-select-type="<%= voicetext %>">手机验证（<%= hidePhone %>）</li>','<li class="location-verify-select-item js-location-verify-select-item" title="<%=hideEmail%>" data-verify-type="2" data-select-type="发送验证码">邮箱验证（<%= hideEmail %>）</li>',"</ul>","</div>","<% } else { %>",'<span class="js-verify-phonenum">手机验证（<%= hidePhone %>）</span>',"<% } %>","</span>","</div>","<% if (securityQuiz) { %>",'<p class="location-verify-other-wrap"><a class="location-verify-other js-location-verify-other" href="javascript:;">其他验证方式</a></p>',"<% } %>",'<input class="location-verify-phone-input js-verify-iptcode" type="text" maxlength="6" placeholder="验证码">','<input type="submit" class="location-verify-vbtn js-verify-voicebtn" data-sms-isoutside="<%= isoutside %>" value="<%= voicetext %>" />','<div class="location-verify-info js-verify-info">您将会接到一个电话，电话中会语言告知您的验证码，验证过程不收取任何费用</div>','<div class="location-verify-ft">','<button class="location-verify-submit js-verify-submit">确定</button>','<button class="location-verify-cancel js-verify-cancel">取消</button>',"</div>","</div>",'<div class="location-verify-qa-wrap" id="location-verify-qa-wrap"></div>',"</div>","</div>");return o=t.compile(a),n=o(e)},getDoms:function(){var o=e("#location-verify-wrap");this.doms={logBox:c.logBox,wrap:o,close:o.find('[data-verify="close"]'),phonenum:o.find(".js-verify-phonenum"),code:o.find(".js-verify-iptcode"),submit:o.find(".js-verify-submit"),voicebtn:o.find(".js-verify-voicebtn"),cancel:o.find(".js-verify-cancel"),selectWrap:o.find(".js-location-verify-select"),selectValue:o.find(".js-location-verify-select-value"),selectList:o.find(".js-location-verify-select-list"),verifyBD:o.find(".js-location-verify-bd")}},show:function(){var o,i=this;e("#location-verify-wrap").size()>0&&e("#location-verify-wrap").off(".verifyPhone").remove(),o=e.extend({},i.options.data,{voicetext:i.voicetext}),c.logBox.append(i.render(o)),i.isoutside&&(e(i.options.info).show(),c.v_type="voice"),n.trigger("dys.login.verify.show",{v_type:c.v_type})},hide:function(){var e=this.doms;e.wrap.off(".verifyPhone").fadeOut().remove()},clearTimer:function(){this.countTimer&&clearTimeout(this.countTimer)},countDown:function(e,o,i){var t=this;o>=0?(e.attr("disabled",!0).addClass("disabled"),e.val(i+"("+o+")"),o--,t.countTimer=setTimeout(function(){t.countDown(e,o,i)},1e3)):(e.attr("disabled",!1).removeClass("disabled"),e.val("重新获取"))},resetText:function(){this.doms.voicebtn.val(this.voicetext).attr("disabled",!1).removeClass("disbaled")},validateCodeHandler:function(){var o=this,i=1===+c.verifyType?o.voicetext:"发送验证码",t=function(t){switch(t.error){case 0:o.countDown(o.doms.voicebtn,60,i);break;case 1:t.msg&&e.dialog.tips_black(t.msg)}o.sendvoicetime=0},n=function(){o.sendvoicetime=0};l.sendPhoneCaptcha({},t,n)},submitHandler:function(){var o,i=this,t=i.doms.code.val(),a=i.getDysType(),r=function(o){if(0!==o.error)return e.dialog.tips_black(o.msg),void n.trigger("dys.login.verify.fail",{v_type:a,em:o.msg});if(n.trigger("dys.login.verify.succ",{v_type:a}),o.data.url){var i=function(o){if(0!==o.error)return void e.dialog.tips_black(o.msg);var i=d.getLocationParam(c.CALLBACK.login);if(i&&window.parent&&window.parent[i]){var t=window.parent[i];if(t&&e.isFunction(t))return o.client_id=c.client_id,o.passport_callback=window.passport_callback||"",void t.call(window.parent,o)}var n=window.passport_callback;setTimeout(function(){location.replace(n)})},t=function(){e.dialog.tips_black(p("编码.登录过程中发生错误，请稍候再试")||"登录过程中发生错误，请稍候再试")};s.API.subSiteLogin(o.data.url,o.data,i,t)}},u=function(){e.dialog.tips_black("验证过程发生错误")};return t?(o={veify_type:c.verifyType,phoneCaptcha:t,client_id:c.client_id},void l.remoteLogin(o,r,u)):void e.dialog.tips_black("请输入验证码")},getDysType:function(){return 1===+c.verifyType?c.v_type:"email"},bindEvt:function(){var o=this,i=o.doms;i.wrap.on("click.verifyPhone.close",o.options.close,function(){o.hide(),o.options.onCancel()}),i.wrap.on("click.verifyPhone.voicebtn",o.options.voicebtn,function(){if(!(o.sendvoicetime>0)){var e=o.getDysType();n.trigger("dys.login.verify.code",{v_type:e}),o.validateCodeHandler(),o.sendvoicetime++}}),i.wrap.on("click.verifyPhone.submit",o.options.submit,function(){var e=o.getDysType();n.trigger("dys.login.verify.confirm",{v_type:e}),o.submitHandler()}),i.wrap.on("click.verifyPhone.cancel",o.options.cancel,function(){n.trigger("dys.login.verify.cancel",{v_type:c.v_type}),o.hide(),o.options.onCancel()}),i.wrap.on("click.account.security.select",".js-location-verify-select",function(){i.selectList.toggle(),i.selectWrap.toggleClass("active")}),i.wrap.on("click.account.security.select",function(o){e(o.target).closest(".js-location-verify-select").length||(i.selectList.hide(),i.selectWrap.removeClass("active"))}),i.wrap.on("click.account.security.select",".js-location-verify-select-item",function(t){var n=e(t.target),a=n.data("select-type"),s=n.data("verify-type");i.selectValue.text(n.text()),i.selectValue.attr("title",n.text()),i.voicebtn.val(a),c.verifyType=s,2===+s?e(o.options.info).hide():1===+s&&"语音验证"===a&&e(o.options.info).show()}),i.wrap.on("click.account.security.select",".js-location-verify-other",function(){i.verifyBD.hide(),r.show(),n.trigger("dys.login.verify.other",{})})}});return u.create=function(e){return new u(e)},{init:function(e){return u.create(e)}}}),define("dypassport/com/location-verify-qa",["jquery","shark/observer","shark/util/lang/1.0","shark/util/template/2.0","dypassport/com/user-control","dypassport/com/dp-login"],function(e,o,i,t,n,a){var s={notComplete:"请完成所有问题之后再提交",netError:"网络故障，请求失败",tipsSuccess:"帐号安全验证成功",CALLBACK:{login:"passport_login_callback"},questionLength:0,answers:[],quizId:null,submitLock:!1,submitUrl:"/iframe/remoteLogin",getSecurityQuiz:"/iframe/securityQuiz",verifyType:3},r={getLocationParam:function(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(o);return null!=i?decodeURIComponent(i[2]):null}},c={init:function(o){var i=o.data;"string"===e.type(i)?this.renderEmpty(i):(s.quizId=i.quizId,s.questionLength=i.quizContent&&i.quizContent.length,this.renderList(i.quizContent||[])),this.getDoms(),this.bindEvent()},getDoms:function(){var o=e("#location-verify-qa-wrap");
this.doms={wrap:o,preWrap:e(".js-location-verify-bd"),cancelBtn:o.find(".js-location-verify-qa-cancel"),closeBtn:e(".location-verify .aui_close")}},renderEmpty:function(o){var i=e("#location-verify-qa-wrap"),t=['<div class="location-verify-qa-nodata">',"<p>"+o+"</p>",'<a class="location-verify-qa-btn js-location-verify-qa-cancel">返回</a>',"</div>"].join("");i.html(t)},renderList:function(o){var i=this.tpl(o),t=e("#location-verify-qa-wrap");t.html(i),e(".location-verify-qa-question-wrap").mCustomScrollbar({theme:"dark-3"})},tpl:function(e){var o=i.string.join("{{if data.length}}",'<p class="location-verify-qa-info">请完成以下安保问题以验证身份，所有选项为单选：</p>','<div class="location-verify-qa-question-wrap">',"{{each data as $qa $i}}",'<p class="location-verify-qa-question">{{$i + 1}}.{{$qa.title}}</p>',"<p>","{{each $qa.answers as $answer $j}}",'<span class="location-verify-qa-answer js-location-verify-qa-answer" data-account-question-index={{$i}} data-account-question-id={{$qa.id}} data-account-answer-index={{$j}}>{{$answer}}</span>',"{{/each}}","</p>","{{/each}}","</div>",'<div class="location-verify-qa-footer">','<a class="location-verify-qa-btn location-verify-qa-submit js-location-verify-qa-submit">提交验证</a>','<a class="location-verify-qa-btn location-verify-qa-cancel js-location-verify-qa-cancel">返回</a>',"</div>","{{ else }}",'<div class="location-verify-qa-nodata">',"<p>亲爱的用户，您的行为过少，请联系客服。</p>",'<a class="location-verify-qa-btn js-location-verify-qa-cancel">返回</a>',"</div>","{{/if}}"),n=t.compile(o);return n({data:e})},refreshQuiz:function(){var o=this;e.ajax({url:s.getSecurityQuiz,type:"post",data:{},dataType:"json",success:function(i){0===+i.error?o.init(i):i.msg&&e.dialog.tips_black(i.msg)},error:function(){e.dialog.tips_black(s.netError)}})},show:function(){var e=this.doms.wrap;e.show()},bindEvent:function(){var i=this,t=i.doms;t.wrap.on("click",".js-location-verify-qa-answer",function(o){var i=e(o.target),t=i.data("account-question-id"),n=i.data("account-question-index"),a=i.data("account-answer-index"),r=i.siblings();r.removeClass("active"),i.addClass("active"),s.answers[n]={id:t,answer:a}}).on("click",".js-location-verify-qa-submit",function(){if(!s.submitLock){var a=t.wrap.find(".js-location-verify-qa-answer.active").length;if(a!==s.questionLength)return void e.dialog.tips_black(s.notComplete);var c={veify_type:s.verifyType,quizId:s.quizId,phoneCaptcha:JSON.stringify(s.answers),client_id:window.client_id||1};s.submitLock=!0,e.ajax({url:s.submitUrl,type:"post",data:c,dataType:"json",success:function(t){if(s.submitLock=!1,0===+t.error){if(o.trigger("dys.login.verify.qa.succ",{type:1}),t.data.url){var a=function(o){if(0!==o.error)return void e.dialog.tips_black(o.msg);var i=r.getLocationParam(s.CALLBACK.login);if(i&&window.parent&&window.parent[i]){var t=window.parent[i];if(t&&e.isFunction(t))return o.client_id=s.client_id,o.passport_callback=window.passport_callback||"",void t.call(window.parent,o)}var n=window.passport_callback;setTimeout(function(){location.replace(n)})},c=function(){e.dialog.tips_black("登录过程中发生错误，请稍候再试")};n.API.subSiteLogin(t.data.url,t.data,a,c)}}else 50002===+t.error?(i.init({data:t.msg}),o.trigger("dys.login.verify.qa.fail",{type:1,em:t.msg})):(t.msg&&e.dialog.tips_black(t.msg),i.refreshQuiz(),o.trigger("dys.login.verify.qa.fail",{type:1,em:t.msg}))},error:function(){s.submitLock=!1,e.dialog.tips_black(s.netError),o.trigger("dys.login.verify.qa.fail",{type:1,em:s.netError})}}),o.trigger("dys.login.verify.qa.confirm",{type:1})}}),t.cancelBtn.on("click",function(){t.wrap.hide(),t.preWrap.show(),o.trigger("dys.login.verify.qa.back",{type:1})})}};return{init:function(e){c.init(e)},show:function(){c.show()}}}),define("dypassport/com/authorized-login",["jquery","dypassport/com/user-control","dypassport/com/user-view-util"],function(e,o,i){function t(o){var i="";try{i=e.i18n.prop(o)}catch(t){}return i}var n="passport_login_callback",a=window.$SYS||{},s=window.client_id||1,r=a.res_url||"",c=window.passport_host||"",l=r+"douyu/images/defaultAvatar.png?20180326",d={arr:a.pc_auth_port||[],host:c.substring(0,c.length-1).replace(/http(s?):\/\//gi,""),index:0,port:"",status:0};d.len=d.arr.length;var p={init:function(){d.status=0,this.getDoms(),this.getUserInfoFromClient()},destroy:function(){d.status=1},getDoms:function(){this.doms={qrcodeRightBox:e("#scancode-qrcode-right")}},authorizedTpl:function(e){var o=e.icon||l,i=e.nickname||"";return['<div class="authorized-login-box" id="js-authorized-box" style="display: none">','<div class="authorized-login-header">',t("编码.点击头像授权登录")||"点击头像授权登录","</div>",'<div class="authorized-login-userInfo">','<div class="authorized-login-userPic js-authorized-btn">','<img src="'+o+'" alt="" />',"</div>",'<div class="authorized-login-userName ellipsis" title="'+i+'">'+i+"</div>","</div>",'<div class="authorized-login-tip">','<span class="authorized-login-icon"></span>','<span class="authorized-login-text">',t("编码.PC客户端在线")||"PC客户端在线","</span>","</div>","</div>"].join("")},authorizedFailTpl:function(){return'<div class="scan-phonetip" id="js-scan-phonetip" style="display: none"></div>'},fadeOutCahnge:function(o,i,t,n){e(t).fadeOut("normal",function(){e(o).html(n),e(i).fadeIn()})},pcNotLoginView:function(){var e=this.doms,o=this.authorizedFailTpl();this.fadeOutCahnge(e.qrcodeRightBox,"#js-scan-phonetip","#js-authorized-box",o)},getUserInfoFromClient:function(){if(!d.status){var i=this,t=i.doms,n=function(o){if(d.port=d.arr[d.index],0===+o.error&&o.data&&o.data.is_login){var n=i.authorizedTpl(o.data);i.fadeOutCahnge(t.qrcodeRightBox,"#js-authorized-box","#js-scan-phonetip",n),i.bindEvent()}else i.pcNotLoginView(),o.msg&&e.dialog.tips_black(o.msg)},s=function(){d.index>=d.len-1||(d.index++,i.getUserInfoFromClient())},r="//local."+d.host+":"+d.arr[d.index]+"/pcclient/getUserInfo",c={lang:a.lang||"cn"};o.API.getUserInfo(r,c,n,s)}},getPcCodeFromClient:function(){var i=this,n=(i.doms,t("编码.授权登录失败")||"授权登录失败"),r=function(o){0===+o.error&&o.data&&o.data.is_login?i.userClientCodeToLogin():(i.pcNotLoginView(),e.dialog.tips_black(n))},c=function(){i.pcNotLoginView(),e.dialog.tips_black(n)},l="//local."+d.host+":"+d.arr[d.index]+"/pcclient/getCode",p={client_id:s,cookie_pre:a.cookie_pre||"",lang:a.lang||"cn"};o.API.getPcCode(l,p,r,c)},userClientCodeToLogin:function(){var i=this,t=function(o){0===+o.error&&"object"==typeof o.data?i.userCodeExchangeToken(o.data.url):e.dialog.tips_black(o.msg)},n=function(){},a={time:(new Date).getTime(),client_id:window.client_id||1};o.API.useClentCodeToLogin(a,t,n)},userCodeExchangeToken:function(a){if(a){var r=function(o){if(0!==o.error)return void e.dialog.tips_black(o.msg);var t=i.getLocationParam(n);if(t&&window.parent&&window.parent[t]){var a=window.parent[t];if(a&&e.isFunction(a))return o.client_id=s,o.passport_callback=window.passport_callback||"",void a.call(window.parent,o)}var r=window.passport_callback;setTimeout(function(){r?location.replace(r):location.reload()})},c=function(){e.dialog.tips_black(t("编码.登录过程中发生错误，请稍候再试")||"登录过程中发生错误，请稍候再试")};o.API.subSiteLogin(a,{},r,c)}},bindEvent:function(){var e=this,o=e.doms;o.qrcodeRightBox.off().on("click.pcclient.toLogin",".js-authorized-btn",function(){e.getPcCodeFromClient()})}};return{init:function(){p.init()},destroy:function(){p.destroy()}}}),define("dypassport/com/scan-qrcode",["jquery","shark/util/lang/1.0","shark/util/cookie/1.0","dypassport/com/user-control","shark/observer","dypassport/com/dp-login","dypassport/com/authorized-login"],function(e,o,i,t,n,a,s){var r={client_id:window.client_id||1,step:1,fac:"",CALLBACK:{reg:"passport_reg_callback",login:"passport_login_callback",close:"passport_close_callback",dp:"passport_dp_callback"},DP:{phone_verify_type:"mes"}},c={serialize:function(e){var o="",i=[];try{for(var t in e)i.push(t+"="+decodeURIComponent(e[t]));o=i.join("&")}catch(n){}return o},formatDate:function(e,o){try{var i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(o)&&(o=o.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var t in i)new RegExp("("+t+")").test(o)&&(o=o.replace(RegExp.$1,1==RegExp.$1.length?i[t]:("00"+i[t]).substr((""+i[t]).length)))}catch(n){}return o},getLocationParam:function(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(o);return null!=i?decodeURIComponent(i[2]):null}},l={init:function(o){this.$scancodeBox=e(".js-scancode-box"),this.$normalLoginBox=e(".js-login-normal"),this.$qrCon=this.$scancodeBox.find(".js-qrcode-con"),this.$qrRefreshbtn=this.$scancodeBox.find(".js-qrcode-refresh"),this.$qrBackbtn=this.$scancodeBox.find(".js-qrcode-back"),this.$qrSwitch=e(".js-qrcode-switch"),this.$toLink=this.$scancodeBox.find(".js-to-link"),this.$loginClose=e(".loginbox-close"),this.status="scan-init",this.qrcode="",this.loopCheckTimer=null,this.dpCache={},this.cbInit=!0,this.callback=o,this.initQrLoginCode(),this.evt()},initQrLoginCode:function(){var e=this,o={client_id:r.client_id},i=function(o){0===o.error&&(e.qrcode=o.data.code,e.makeQrCode(o.data.url),e.loopCheck(o.data.code))};t.API.qrGenerateCode(o,i)},checkCanvasSupport:function(){var e=!0;try{e=!!document.createElement("canvas").getContext}catch(o){e=!1}return e},makeQrCode:function(e){this.$qrCon.html("");var o="canvas",i=this.checkCanvasSupport();i||(o="table"),this.$qrCon.qrcode({render:o,width:123,height:123,correctLevel:0,text:e})},loopCheck:function(o){var i=this,n=1e3;return this.status&&e.inArray(this.status,["scan-fail","scan-hide","scan-reg"])>-1?void this.clearLoopCheckTimer():void(this.loopCheckTimer=setTimeout(function(){var e={code:o},n=function(e){switch(e.error){case 0:return i.clearLoopCheckTimer(),void i.appClientSuccessHandler(e.data);case 1:i.switchQrViewByStatus("scan-success"),i.DP("dys.login.qrcode.succ");break;case-1:i.resetQrView(),i.clearLoopCheckTimer(),i.switchQrViewByStatus("scan-fail")}e=null,i.loopCheck(o)},a=function(){i.clearLoopCheckTimer()};t.API.qrCheckScan(e,n,a)},n))},clearLoopCheckTimer:function(){clearTimeout(this.loopCheckTimer),this.loopCheckTimer=null},getAppClientSuccessJSONP:function(o,i,t,n){o&&(t=t||e.noop,n=n||e.noop,e.ajax({url:o,type:"GET",data:i,dataType:"jsonp",jsonp:"callback",jsonpCallback:"appClient_json_callback",success:t,error:n}))},appClientSuccessHandler:function(e){var o=this;if(e.url){var i=function(e){o.qrLoginSuccessCallback(e)};o.getAppClientSuccessJSONP(e.url,{},i)}},qrLoginSuccessCallback:function(o){if(0!==o.error)return e.dialog.tips_black(o.msg),void this.DP("dys.login.qrcode.fail",{em:o.msg});var i=c.getLocationParam(r.CALLBACK.login);if(i&&window.parent&&window.parent[i]){var t=window.parent[i];if(t&&e.isFunction(t))return o.client_id=r.client_id,o.passport_callback=window.passport_callback||"",void t.call(window.parent,o)}var n=window.passport_callback;setTimeout(function(){location.replace(n)})},switchQrViewByStatus:function(o){var i="status-scan status-scansucceed status-scanfail hide";switch(o){case"scan-init":this.$normalLoginBox.addClass("hide"),this.$scancodeBox.removeClass(i).addClass("status-scan"),this.status="scan-init";break;case"scan-fail":this.$scancodeBox.removeClass(i).addClass("status-scan status-scanfail"),this.status="scan-fail";break;case"scan-success":this.$scancodeBox.removeClass(i).addClass("status-scansucceed"),this.status="scan-success";break;case"scan-hide":this.cbInit&&(e.isFunction(this.callback)&&this.callback(),this.cbInit=!1),this.$scancodeBox.removeClass(i).addClass("hide"),this.$normalLoginBox.removeClass("hide"),this.status="scan-hide"}},toggleLoginQrView:function(){"scan-hide"===this.status||"scan-reg"===this.status?(this.switchQrViewByStatus("scan-init"),this.DP("dys.login.qrcode.toqrcode")):(this.switchQrViewByStatus("scan-hide"),this.DP("dys.login.entry",{loginType:"login-by-phoneNum",type:2}))},resetQrView:function(){this.dpCache={},this.clearLoopCheckTimer()},evt:function(){this.$qrRefreshbtn.on("click.qrcode.refresh",e.proxy(this.qrRefreshHandler,this)),this.$qrBackbtn.on("click.qrcode.back",e.proxy(this.qrBackHandler,this)),this.$qrSwitch.on("click.qrcode.switch",e.proxy(this.qrSwitchHandler,this)),this.$toLink.on("click.qrcode.tolink",e.proxy(this.qrToLink,this)),this.$loginClose.on("click.qrcode.close",e.proxy(this.qrDeleteCode,this))},qrRefreshHandler:function(){this.switchQrViewByStatus("scan-init"),this.initQrLoginCode(),this.DP("dys.login.qrcode.refresh")},qrBackHandler:function(){this.qrDeleteCode(),this.switchQrViewByStatus("scan-init"),this.resetQrView(),this.initQrLoginCode()},qrSwitchHandler:function(){this.toggleLoginQrView(),"scan-init"===this.status&&(this.initQrLoginCode(),s.init()),"scan-hide"===this.status&&(this.resetQr(),s.destroy())},qrToLink:function(o){var i=e(o.target),t=i.data("type");this.status="scan-hide",this.resetQr(),n.trigger("qrcode.clicl.toLink.loginOrReg",t)},qrDeleteCode:function(){var e=this;if(this.qrcode){var o={code:this.qrcode},i=function(){e.qrcode=""},n=function(){e.qrcode=""};t.API.qrDeleteCode(o,i,n)}},resetQr:function(){this.resetQrView(),this.qrDeleteCode()},DP:function(o,i){if(!this.dpCache[o]||"dys.login.qrcode.succ"!==o){var t={step:r.step++,fac:r.fac};t=e.extend(!0,t,i||{}),n.trigger(o,t),this.dpCache[o]=t}}};return l}),define("dypassport/com/user-view-util",["jquery"],function(e){function o(o){var i="";try{i=e.i18n.prop(o)}catch(t){}return i}var i={countTimer:null,isTimer:!1,serialize:function(e){var o="",i=[];try{for(var t in e)i.push(t+"="+decodeURIComponent(e[t]));o=i.join("&")}catch(n){}return o},formatDate:function(e,o){try{var i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};/(y+)/.test(o)&&(o=o.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length)));for(var t in i)new RegExp("("+t+")").test(o)&&(o=o.replace(RegExp.$1,1==RegExp.$1.length?i[t]:("00"+i[t]).substr((""+i[t]).length)))}catch(n){}return o},getLocationParam:function(e){var o=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(o);return null!=i?decodeURIComponent(i[2]):null},addParam:function(o,i){var t=e(".loginbox-con"),n=t.find('.third-icon-qq[data-point-2="qq"]'),a=t.find('.third-icon-wx[data-point-2="wx"]'),s=t.find('.third-icon-wb[data-point-2="wb"]'),r=t.find('.third-icon-fb[data-point-2="fb"]'),c=function(e){e.length&&(e.attr("href").indexOf("?")>-1?e.attr("href",e.attr("href")+"&fac="+i.fac+"&type="+o):e.attr("href",e.attr("href")+"?fac="+i.fac+"&type="+o))};c(n,o),c(a,o),c(s,o),r.length&&c(r,o)},countDown:function(e,t,n){this.second||(this.second=n),this.second>=0?(e.attr("disabled",!0),e.val(t+"("+this.second+")"),e.addClass("long"),this.second--,i.countTimer=setTimeout(function(){i.countDown(e,t)},1e3)):(i.countTimer=null,e.removeClass("long"),e.attr("disabled",!1),e.val(o("编码.重新获取")||"重新获取"))},resetCountDown:function(e){i.countTimer&&(i.countTimer=null,this.second=0)}};return i}),define("dypassport/com/user-view-iframe",["jquery","dypassport/com/user-view-util"],function(e,o){var i={init:function(){i.resetDomain()},resetDomain:function(){var e=document.domain;try{e=e.split(".").slice(-2).join(".")}catch(o){console.log&&console.log(o)}document.domain=e},checkLoginnedUserAuthData:function(){var e={};return window.passport_code&&"0"!=window.passport_uid?(e.passport_callback=window.passport_callback,e.code=window.passport_code,e.uid=window.passport_uid,e):!1},apiLoginCallback:function(i){var t=o.getLocationParam(Vars.CALLBACK.login);if(t&&window.parent&&window.parent[t]){var n=window.parent[t];n&&e.isFunction(n)&&n.call(window.parent,i)}},dpCallback:function(i){var t=o.getLocationParam(Vars.CALLBACK.dp);if(t&&window.parent&&window.parent[t]){var n=window.parent[t];n&&e.isFunction(n)&&n.call(window.parent,i)}}};return i}),define("dypassport/com/static-config",[],function(){var e={areaConfig:[{area:"中国大陆",code:"86"},{area:"中国澳门",code:"853"},{area:"中国香港",code:"852"},{area:"中国台湾",code:"886"},{area:"阿尔巴尼亚",code:"355"},{area:"阿尔及利亚",code:"213"},{area:"阿富汗",code:"93"},{area:"阿根廷",code:"54"},{area:"阿拉伯联合酋长国",code:"971"},{area:"阿鲁巴岛",code:"297"},{area:"阿曼",code:"968"},{area:"阿塞拜疆",code:"994"},{area:"阿森松岛",code:"247"},{area:"埃及",code:"20"},{area:"埃塞俄比亚",code:"251"},{area:"爱尔兰",code:"353"},{area:"爱沙尼亚",code:"372"},{area:"安道尔",code:"376"},{area:"安哥拉",code:"244"},{area:"安圭拉岛",code:"1264"},{area:"安提瓜和巴布达",code:"1268"},{area:"奥地利",code:"43"},{area:"澳大利亚",code:"61"},{area:"巴巴多斯",code:"1246"},{area:"巴布亚新几内亚",code:"675"},{area:"巴哈马",code:"1242"},{area:"巴基斯坦",code:"92"},{area:"巴拉圭",code:"595"},{area:"巴勒斯坦",code:"970"},{area:"巴林",code:"973"},{area:"巴拿马",code:"507"},{area:"巴西",code:"55"},{area:"白俄罗斯",code:"375"},{area:"百慕大",code:"1441"},{area:"保加利亚",code:"359"},{area:"北马里亚纳群岛",code:"1"},{area:"贝宁",code:"229"},{area:"比利时",code:"32"},{area:"冰岛",code:"354"},{area:"波多黎各",code:"1787"},{area:"波黑",code:"387"},{area:"波兰",code:"48"},{area:"玻利维亚",code:"591"},{area:"伯利兹",code:"501"},{area:"博茨瓦纳",code:"267"},{area:"博奈尔岛、圣尤斯特歇斯和萨巴岛",code:"599"},{area:"不丹",code:"975"},{area:"布基纳法索",code:"226"},{area:"布隆迪",code:"257"},{area:"朝鲜",code:"850"},{area:"赤道几内亚",code:"240"},{area:"丹麦",code:"45"},{area:"德国",code:"49"},{area:"迪戈加西亚岛",code:"246"},{area:"东帝汶",code:"670"},{area:"多哥",code:"228"},{area:"多米尼加",code:"1767"},{area:"多米尼加共和国",code:"1809"},{area:"俄罗斯",code:"7"},{area:"厄瓜多尔",code:"593"},{area:"厄立特里亚",code:"291"},{area:"法国",code:"33"},{area:"法罗群岛",code:"298"},{area:"法属波利尼西亚",code:"689"},{area:"法属圭亚那",code:"594"},{area:"梵蒂冈",code:"379"},{area:"菲律宾",code:"63"},{area:"斐济",code:"679"},{area:"芬兰",code:"358"},{area:"佛得角",code:"238"},{area:"福克兰群岛",code:"500"},{area:"冈比亚",code:"220"},{area:"刚果",code:"242"},{area:"刚果民主共和国",code:"243"},{area:"哥伦比亚",code:"57"},{area:"哥斯达黎加",code:"506"},{area:"格林纳达",code:"1473"},{area:"格陵兰",code:"299"},{area:"格鲁吉亚",code:"995"},{area:"古巴",code:"53"},{area:"瓜德罗普",code:"590"},{area:"关岛",code:"1671"},{area:"圭亚那",code:"592"},{area:"哈萨克斯坦",code:"7"},{area:"海地",code:"509"},{area:"韩国",code:"82"},{area:"荷兰",code:"31"},{area:"荷属圣马丁",code:"1721"},{area:"黑山",code:"382"},{area:"洪都拉斯",code:"504"},{area:"基里巴斯",code:"686"},{area:"吉布提",code:"253"},{area:"吉尔吉斯斯坦",code:"996"},{area:"几内亚",code:"224"},{area:"几内亚比绍",code:"245"},{area:"加拿大",code:"1"},{area:"加纳",code:"233"},{area:"加蓬",code:"241"},{area:"柬埔寨",code:"855"},{area:"捷克共和国",code:"420"},{area:"津巴布韦",code:"263"},{area:"喀麦隆",code:"237"},{area:"卡塔尔",code:"974"},{area:"开曼群岛",code:"1345"},{area:"科摩罗和马约特岛",code:"269"},{area:"科特迪瓦",code:"225"},{area:"科威特",code:"965"},{area:"克罗地亚",code:"385"},{area:"肯尼亚",code:"254"},{area:"库克群岛",code:"682"},{area:"库拉索",code:"599"},{area:"拉脱维亚",code:"371"},{area:"莱索托",code:"266"},{area:"老挝",code:"856"},{area:"黎巴嫩",code:"961"},{area:"立陶宛",code:"370"},{area:"利比里亚",code:"231"},{area:"利比亚",code:"218"},{area:"列支敦士登",code:"423"},{area:"留尼旺岛",code:"262"},{area:"卢森堡",code:"352"},{area:"卢旺达",code:"250"},{area:"罗马尼亚",code:"40"},{area:"马达加斯加",code:"261"},{area:"马尔代夫",code:"960"},{area:"马耳他",code:"356"},{area:"马拉维",code:"265"},{area:"马来西亚",code:"60"},{area:"马里",code:"223"},{area:"马其顿",code:"389"},{area:"马绍尔群岛",code:"692"},{area:"马提尼克岛",code:"596"},{area:"毛里求斯",code:"230"},{area:"毛里塔尼亚",code:"222"},{area:"美国",code:"1"},{area:"美属萨摩亚",code:"1684"},{area:"美属维尔京群岛",code:"1340"},{area:"蒙古",code:"976"},{area:"蒙特塞拉特岛",code:"1664"},{area:"孟加拉国",code:"880"},{area:"秘鲁",code:"51"},{area:"密克罗尼西亚",code:"691"},{area:"缅甸",code:"95"},{area:"摩尔多瓦",code:"373"},{area:"摩洛哥",code:"212"},{area:"摩纳哥",code:"377"},{area:"莫桑比克",code:"258"},{area:"墨西哥",code:"52"},{area:"纳米比亚",code:"264"},{area:"南非",code:"27"},{area:"南苏丹",code:"211"},{area:"瑙鲁",code:"674"},{area:"尼加拉瓜",code:"505"},{area:"尼泊尔",code:"977"},{area:"尼日尔",code:"227"},{area:"尼日利亚",code:"234"},{area:"纽埃岛",code:"683"},{area:"挪威",code:"47"},{area:"诺福克岛",code:"6723"},{area:"帕劳",code:"680"},{area:"葡萄牙",code:"351"},{area:"日本",code:"81"},{area:"瑞典",code:"46"},{area:"瑞士",code:"41"},{area:"萨尔瓦多",code:"503"},{area:"萨摩亚",code:"685"},{area:"塞尔维亚",code:"381"},{area:"塞拉利昂",code:"232"},{area:"塞内加尔",code:"221"},{area:"塞浦路斯",code:"357"},{area:"塞舌尔",code:"248"},{area:"沙特阿拉伯",code:"966"},{area:"圣巴泰勒米岛",code:"590"},{area:"圣多美和普林西比",code:"239"},{area:"圣赫勒拿岛",code:"290"},{area:"圣基茨和尼维斯",code:"1869"},{area:"圣卢西亚",code:"1758"},{area:"圣马丁",code:"590"},{area:"圣马力诺",code:"378"},{area:"圣皮埃尔和密克隆群岛",code:"508"},{area:"圣文森特和格林纳丁斯",code:"1784"},{area:"斯里兰卡",code:"94"},{area:"斯洛伐克",code:"421"},{area:"斯洛文尼亚",code:"386"},{area:"斯威士兰",code:"268"},{area:"苏丹",code:"249"},{area:"苏里南",code:"597"},{area:"所罗门群岛",code:"677"},{area:"索马里",code:"252"},{area:"塔吉克斯坦",code:"992"},{area:"泰国",code:"66"},{area:"坦桑尼亚",code:"255"},{area:"汤加",code:"676"},{area:"特克斯和凯科斯群岛",code:"1649"},{area:"特立尼达和多巴哥",code:"1868"},{area:"突尼斯",code:"216"},{area:"图瓦卢",code:"688"},{area:"土耳其",code:"90"},{area:"土库曼斯坦",code:"993"},{area:"托克劳",code:"690"},{area:"瓦利斯和富图纳群岛",code:"681"},{area:"瓦努阿图",code:"678"},{area:"危地马拉",code:"502"},{area:"委内瑞拉",code:"58"},{area:"文莱",code:"673"},{area:"乌干达",code:"256"},{area:"乌克兰语",code:"380"},{area:"乌拉圭",code:"598"},{area:"乌兹别克斯坦",code:"998"},{area:"希腊",code:"30"},{area:"西班牙",code:"34"},{area:"新加坡",code:"65"},{area:"新喀里多尼亚",code:"687"},{area:"新西兰",code:"64"},{area:"匈牙利",code:"36"},{area:"叙利亚",code:"963"},{area:"牙买加",code:"1876"},{area:"亚美尼亚",code:"374"},{area:"也门",code:"967"},{area:"伊拉克",code:"964"},{area:"伊朗",code:"98"},{area:"以色列",code:"972"},{area:"意大利",code:"39"},{area:"印度",code:"91"},{area:"印度尼西亚",code:"62"},{area:"英国",code:"44"},{area:"英属维尔京群岛",code:"1284"},{area:"约旦",code:"962"},{area:"越南",code:"84"},{area:"赞比亚",code:"260"},{area:"乍得",code:"235"},{area:"直布罗陀",code:"350"},{area:"智利",code:"56"},{area:"中非共和国",code:"236"}]};return e}),define("dypassport/com/select-area",["jquery","shark/class","shark/util/lang/1.0","shark/util/template/2.0","dypassport/com/static-config","dypassport/com/i18n"],function(e,o,i,t,n,a){var s=n.areaConfig,r=o({init:function(o){this.config=e.extend(!0,{container:null,target:null,isEnglish:0,selectClass:"selectCountry-avtive",trigonUp:"selectCountry-san1",extFnObj:{clickParent:e.noop,selectLi:e.noop}},o||{}),this.config.target&&(this.render(),this.getDoms(),this.bindEvent(),this.config.isEnglish&&a.interprete())},render:function(){var e=this,o=i.string.join('<div class="select-area-wrap">','<input class="selectCountry-box-code js-selectCountry-box-code" type="text" name="areaCode" value="+86"/>','<div class="selectCountry-san-box">','<span class="selectCountry-san js-selectCountry-san"></span>',"</div>",'<ul class="select-country-list js-select-country-list clearfix">',"{{ each list as item index }}",'<li value="00{{ item.code }}">','<span class="fl selectCountry-country" ','{{ if isEnglish }} data-i18n="{{ item.area }}" {{ /if }}>{{ item.area }}',"</span>",'<span class="fr selectCountry-value">+{{ item.code }}</span>',"</li>","{{ /each }} ","</ul>","</div>"),n=t.compile(o),a=n({list:s,isEnglish:e.config.isEnglish});this.config.target.append(a)},getDoms:function(){var e=this.config.target;this.doms={target:e,selectUl:e.find(".js-select-country-list"),codeInput:e.find(".js-selectCountry-box-code"),triangle:e.find(".js-selectCountry-san")}},bindEvent:function(){var o=this.config,i=this.doms,t=function(e){e.stopPropagation(),e.preventDefault()};o.container&&o.container.length&&o.container.on("click",function(){e(this).closest(".js-select-country-list").length||(i.selectUl.hide(),i.triangle.removeClass(o.trigonUp))}),i.target.on("click",function(e){t(e),i.selectUl.toggle(),i.triangle.toggleClass(o.trigonUp),o.extFnObj.clickParent&&o.extFnObj.clickParent()}),i.selectUl.on("click","li",function(n){t(n),i.selectUl.find("li").removeClass(o.selectClass),e(this).addClass(o.selectClass),i.selectUl.hide(),i.triangle.toggleClass(o.trigonUp);var a=i.selectUl.find("."+o.selectClass+" .selectCountry-value").text()||"+86";i.codeInput.val(a),o.extFnObj.selectLi&&o.extFnObj.selectLi(a)})}});return{init:function(e){return new r(e)}}}),define("dypassport/com/user-view-login",["jquery","shark/observer","shark/util/cookie/1.0","dypassport/com/user-control","dypassport/com/user-view-common","dypassport/com/dp-login","dypassport/com/location-log-verify","dypassport/com/scan-qrcode","dypassport/com/user-view-util","dypassport/com/user-view-iframe","dypassport/com/select-area","dypassport/com/authorized-login","dypassport/com/verify/verify"],function(e,o,i,t,n,a,s,r,c,l,d,p,u){function f(o){var i="";try{i=e.i18n.prop(o)}catch(t){}return i}n.init();var h={view:{el:{pop:"pop",shadow:"shadow",logform:"logform"},type:{login:"login",reg:"reg"},subLoginType:"login-by-phoneNum",currentView:null},isInit:!1,client_id:window.client_id||1,lang:window.$SYS?$SYS.lang:"cn",hmac_flash_ready:!1,step:1,fac:"",salt:null,CALLBACK:{reg:"passport_reg_callback",login:"passport_login_callback",close:"passport_close_callback",dp:"passport_dp_callback"},closeStatus:0,areaCode:"0086",lock:{submit:!1,sms:!1,editName:!1,hasSendSMS:!1},isNewUser:!1,vType:0,captchaLoadSucc:0},g={},v={},y={},m='<span class="capsLock-tip js-capsLock"><i class="capsLockTip-triangle"></i>大写锁定已打开</span>',w=function(){var o=e(".loginbox-p.login-by-phoneNum.login-by-nickname"),i=e(".js-capsLock");i.length<=0&&o.append(m),i.removeClass("hide")},b=function(){var o=e(".js-capsLock");o&&o.length>0?o.addClass("hide"):null},_=navigator.userAgent,k=_.indexOf("compatible")>-1&&_.indexOf("MSIE")>-1,C=_.indexOf("Trident")>-1&&_.indexOf("rv:11.0")>-1;g.control=t,g.init=function(){l.init(),v.init(),g.view.initEvt(),r.init(g.view.init),p.init()},g.view={init:function(){h.view.isInit||(h.view.isInit=!0,g.view.$pop=e(".loginbox-con"),h.view.currentView=g.view.$pop.find(".loginbox-bd[data-type=login]"),g.view.$logform=g.view.$pop.find(".loginbox-login form"),g.view.$voiceBtn=g.view.$pop.find(".js-sendvoice"),g.view.$thirds=g.view.$pop.find(".third-list a"),g.view._is_show=!1,setTimeout(function(){g.view.checkStkToLogin(),g.view.evt()},50),d.init({container:e("#loginbox"),target:e(".js-selectCountry-box"),isEnglish:"en"===h.lang,extFnObj:{clickParent:function(){o.trigger("dys.login.click_phone_country",{step:h.step++,fac:h.fac})},selectLi:function(e){var o=g.view.$voiceBtn,i=o.val();if(h.areaCode=String(e).replace("+","00"),o.length&&!o.hasClass("long")){var t=window.$SYS?window.$SYS.foreign_captcha_type:2,n=1===+t?"语音":"短信";"0086"===h.areaCode?o.val(i.replace(n,"短信")):o.val(i.replace("短信",n))}}}}),g.SubLoginType.init(),y.init())},el:function(e){return e===h.view.el.pop?g.view.$pop:e===h.view.el.logform?g.view.$logform:void 0},loginTip:function(o){var i,t,n,a=o.type?".login-cheak-"+o.type:"",s=o.iconType||"",r=o.cont||"",c=1e3*o.delay||1500,l=o.isAlwaysShow||0;return i=h.view.currentView.find(a),t='<span class="myuser-tip-icon myuser-tip-icon'+s+'"></span><span class="myuser-tip-text'+s+'">'+r+"</span>",n=e(t),g.view.hideTips(),i.html(n),l||setTimeout(function(){n.fadeOut("fast",function(){n.remove()})},c),n},errorPopTip:function(o){var i,t=o.username||"",n=o.userState,a=o.userStateStr||"",s=o.endTimeStr||"",r=o.startTimeStr||"",c=o.endTime||"",l=o.startTime||"",d=o.enMsg||"";if(0===n){var p=o.reasonStr;i='<p>封禁原因：<span class="ellipsis forbiddenReason" title='+p+">"+p+"</span></p>"}else i="";"en"===h.lang?render=['<div class="userForbidden">','<div class="forbiddenClose">&times;</div>','<div class="userForbiddenBox">',"<p>"+d+"</p><br>","</div>","</div>","</div>"].join(""):render=['<div class="userForbidden">','<div class="forbiddenClose">&times;</div>','<div class="userForbiddenBox">','<p class="forbiddenUsername" title='+t+'><span class="ellipsis forbiddenUserName">'+t+"</span>"+a+"</p>",i,"<p>"+r+l+"</p>","<p>"+s+c+"</p>",'<p>如有疑问请&nbsp<a target="_blank" href="https://kefu.douyu.com" class="forbiddenServer">联系客服</a>',"&nbsp处理</p>","</div>","</div>"].join(""),$html=e(render),g.view.$logform.append($html),g.view.$logform.find("input.loginbox-sbt").val("登录"),$html.on("click",".forbiddenClose",function(o){h.lock.submit=!1,g.view._evt_stop(o),e(this).closest("div.userForbidden").hide()})},hideTips:function(){h.view.currentView.find("p.myuser-tip").empty()},make:function(){return{pop:e.trim(e("#dytemp-loginbox").html()),shadow:e.trim(e("#dytemp-loginbox-shadow").html())}},checkStkToLogin:function(){i.get("ltkid")&&i.get("nickname")&&i.get("uid")&&!i.get("stk")&&this.show()},show:function(i,t){o.trigger("dys.login.show",{step:h.step++,fac:h.fac});var n=h.view.showParam;n&&n.source&&(h.fac=n.source),n=e.isPlainObject(n)?n:{},e.extend(!0,h,n),h.callback||(h.callback=n.callback),c.addParam(h.view.type.login,{fac:h.fac})},hide:function(){g.view.$pop.fadeOut(function(){g.view._is_show=!1})},toggle:function(){g.view._is_show?g.view.hide():g.view.show()},redirect:function(e){var o=g.view._redirect;return o?(g.view._redirect=void 0,setTimeout(function(){location.href=o},e||50),!0):!1},callback:function(o){if(e.isFunction(h.callback))try{h.callback(o)}catch(i){}},initEvt:function(){var i=e(".loginbox-con"),t=i.find(".js-login-normal"),n=i.find(".js-scancode-box");i.on("click",".loginbox-close",function(i){o.trigger("dys.com.user.login.close.click",{step:h.step++,fac:h.fac}),g.view._evt_stop(i),g.view.$bd=e(".loginbox-bd:not(.hide)");var t=c.getLocationParam(h.CALLBACK.close);if(t&&window.parent&&window.parent[t]){var n=window.parent[t];n&&e.isFunction(n)&&n.call(window.parent,h.closeStatus)}}),o.on("qrcode.clicl.toLink.loginOrReg",function(e){return n.addClass("hide"),t.removeClass("hide"),g.view.init(),o.trigger("dys.login.entry",{loginType:"login-by-phoneNum",type:1,step:h.step++,fac:h.fac}),!1})},evt:function(){var i=g.view.$pop,t=g.view.$logform,n=g.view.$thirds,a={};t.on("click",".captcha-gt",function(){o.trigger("dys.login.click_code",{step:h.step++,fac:h.fac,type:1})}).on("click",".captcha",function(){o.trigger("dys.login.click_code",{step:h.step++,fac:h.fac,type:2})}),i.on("change","input ,select",function(i){var t=e(this),n=t.data("modified");if(!n)return!1;try{var a=t.attr("name"),s="0086"===h.areaCode?"mes":"voice",r=["phoneNum","password","username","phoneCaptcha"];r.indexOf(a)>=0&&o.trigger("dys.login.input.change",{loginType:h.view.subLoginType,inputType:a,step:h.step++,fac:h.fac,v_type:s}),n=!1,t.data("modified",!1)}catch(c){}}).on("keyup mouseup","input ,select",function(){e(this).data("modified",!0)}),n.on("mousedown",function(){var i=e(this),t=h.view.currentView.data("type"),n=i.attr("data-point-2"),a="";switch(n){case"qq":a="qq";break;case"wx":a="weixin";break;case"wb":a="sinawb";break;case"fb":a="facebook"}"login"===t&&o.trigger("dys.login.thirds",e.extend({},g.REGPageData,{step:h.step++,type:a,fac:h.fac}))}),e(".forget-pwd").on("click",function(){o.trigger("dys.login.password.forget",{step:h.step++,fac:h.fac})}),i.on("change","input",function(){g.validate.check(this,"login")}),t.on("keyup change",'input[name="password"]',function(o){a.same(e(this));var o=o||window.event,i=o.keyCode?o.keyCode:o.which,t=o.shiftKey?o.shiftKey:16==i,n=e(o.target).val().length;if(n>0){var s=e(o.target).val().charCodeAt(n-1);i>=65&&90>=i&&(s>=65&&90>=s&&!t||s>=97&&122>=s&&t?k||C||w():b())}}).on("click","span.pw-span",function(){a.show(e(this))}),t.on("blur",'input[name="password"]',function(){b()}),t.on("click",".js-sendvoice",function(){h.vType=1,g.view.loginCaptcha(),o.trigger("dys.login.fastphone.getcode",{v_type:"0086"===h.areaCode?"mes":"voice",step:h.step++,fac:h.fac})}),t.submit(function(){return h.lock.submit||(h.vType=2,g.view.submitLog(),o.trigger("dys.login.tologin",{loginType:h.view.subLoginType,step:h.step++,fac:h.fac})),!1}),a.same=function(e){var o=e.val();"password"===e.attr("type")&&e.next('input[type="text"]').val(o),"text"===e.attr("type")&&e.prev('input[type="password"]').val(o)},a.show=function(e){var o=e.closest("div");e.hasClass("pw-hide")?(e.removeClass("pw-hide").addClass("pw-show"),o.find('input[type="text"]').val(o.find('input[type="password"]').val()).css({zIndex:1})):(e.removeClass("pw-show").addClass("pw-hide"),o.find('input[type="text"]').css({zIndex:-1}))}},_evt_stop:function(e){
e.stopPropagation(),e.preventDefault()},checkCaptcha:function(o){var i=g.view.el(h.view.el.logform).find(".captcha-gt"),t=!!i.length;if(!t)return!0;var n=y.verify?y.verify.verifyData:{},a=n.code_type;if(1===a)return!0;if(!y.verify||!y.verify.instance)return 2===h.captchaLoadSucc&&e.dialog.tips_black("验证码加载失败，请稍后再试"),!1;switch(o){case"login":var s=y.verify.instance.getResult().code;return"login-by-sms"===h.view.subLoginType?!0:s&&4===s.length?!0:(3===a?y.verify.instance.show():2===a&&(e('[name="captcha_word"].verify-imgCode-input').addClass("verify-captcha-error"),setTimeout(function(){e('[name="captcha_word"].verify-imgCode-input').removeClass("verify-captcha-error")},2e3)),!1);case"sms":var s=y.verify.instance.getResult().code;return s&&4===s.length?!0:(3===a?y.verify.instance.show():2===a&&(e('[name="captcha_word"].verify-imgCode-input').addClass("verify-captcha-error"),setTimeout(function(){e('[name="captcha_word"].verify-imgCode-input').removeClass("verify-captcha-error")},2e3)),!1);default:return!0}},captchaRefresh:function(){y.verify&&y.verify.instance&&y.verify.instance.refresh&&y.verify.instance.refresh()},getCodeVerifyParams:function(){var e=y.verify?y.verify.verifyData:{};if(!y.verify)return{};var o=y.verify&&y.verify.instance?y.verify.instance.getResult():{},i={room_id:g.REGPageData.room_id,code_verify_data:{code_type:e.code_type,code_token:e.code_token,code_data:{}}};if(1===parseInt(e.code_type,10)){var t={geetest_challenge:o.challenge,id:o.id,gt_version:"v4"};i.code_verify_data.code_data=t}else{var n=y.verify&&y.verify.instance?y.verify.instance.getResult().code:"";i.code_verify_data.code_data.code=n}return i},submitLog:function(){var o=g.view.$logform,i=o.find(".btn-sub"),t=[],n=!0,a=null,s={};if(!o.data("submit")){switch(h.view.subLoginType){case"login-by-nickname":t=o.find(".login-by-nickname [name]:not(.notsub)");break;case"login-by-phoneNum":t=o.find(".login-by-phoneNum [name]:not(.notsub)");break;case"login-by-sms":t=o.find(".login-by-sms [name]:not(.notsub)")}if(t.each(function(){return(n=g.validate.check(this,"login"))?void("areaCode"===this.name?s[this.name]=h.areaCode:s[this.name]=this.value):!1}),n&&g.view.checkCaptcha("login")){if("login-by-sms"===h.view.subLoginType&&!h.lock.hasSendSMS)return void e.dialog.tips_black("请先完成短信验证");if(y.verify&&y.verify.instance&&!(a=y.verify.instance.getResult()))return void y.verify.instance.show();s=e.extend({},s,g.view.getCodeVerifyParams(),h.salt),o.data("submit",!0),i.val(f("编码.提交中…")||"提交中…"),g.view.enter(s,function(e){g.view.callback(e),o.data("submit",e),i.val(f("编码.登录")||"登录")})}}},enter:function(e,o){g.view._enter(e,o)},_enter:function(t,n){var a=this,r=function(i){var t=parseInt(i.error,10),r="";switch(t){case 0:a.subLoginJsonp(i.data);break;case 3:var l=i.data,d={username:l.nick_name,startTime:l.operate_time,endTime:l.expire_time,endTimeStr:"失效时间："};0===parseInt(l.has_recharge,10)?(d.userState=0,d.userStateStr="&nbsp;已被封禁",d.startTimeStr="封禁时间：",d.reasonStr=l.reason):(d.userState=1,d.userStateStr="&nbsp;因帐号异常已被冻结",d.startTimeStr="冻结时间："),"en"===h.lang?(r=f("编码.因违规操作，您的帐号被冻结/被封禁")||"因违规操作，您的帐号被冻结/被封禁",g.view.errorPopTip({enMsg:r})):g.view.errorPopTip(d),o.trigger("dys.login.fail",{loginType:h.view.subLoginType,step:h.step++,em:"封禁",fac:h.fac});break;case 130014:s.init({data:i.data,onCancel:function(){g.view.$logform.data("submit",!1),g.view.$logform.find(".btn-sub").val(f("编码.登录")||"登录")}});break;case-1004:y.verify.verifyData.code_token=i.data.code_token,g.view.captchaRefresh(),e.dialog.tips_black("验证码失效");break;default:c.resetCountDown(g.view.$voiceBtn),r=i.msg,e.dialog.tips_black(r),o.trigger("dys.login.fail",{loginType:h.view.subLoginType,step:h.step++,em:i.msg,fac:h.fac})}3!==t&&(h.lock.submit=!1),n(!1),g.view.captchaRefresh()},l=function(){h.lock.submit=!1,n(!1),o.trigger("dys.login.fail",{loginType:h.view.subLoginType,step:h.step++,em:"登录过程中发生错误，请稍候再试！",fac:h.fac}),e.dialog.tips_black(f("编码.登录过程中发生错误，请稍候再试")||"登录过程中发生错误，请稍候再试"),g.view.captchaRefresh()},d=t.password;d&&(h.md5_m=CryptoJS.MD5(d).toString(),t.password=h.md5_m),t.redirect_url=location.href,t.t=(new Date).getTime(),t.client_id=h.client_id,h.isNewUser&&g.REGPageData&&(t=e.extend({},t,g.REGPageData));try{t.sm_did=SMSdk.getDeviceId()||""}catch(p){}t.did=i.get("did")||"",t.lang=h.lang,h.lock.submit=!0,g.control.API.iframeLogin(t,r,l)},subLoginJsonp:function(i){if(i.url){var t=function(t){if(0!==t.error)return void e.dialog.tips_black(t.msg);if("login-by-nickname"===h.view.subLoginType){var n={type:"nick",step:h.step++,fac:h.fac};o.trigger("dys.login.nickname.succ",n)}if("login-by-phoneNum"===h.view.subLoginType&&i.nickname){var n={type:"sign",step:h.step++,fac:h.fac};o.trigger("dys.login.nickname.succ",n)}var n={loginType:h.view.subLoginType,step:h.step++,fac:h.fac};"login-by-sms"===h.view.subLoginType&&(n.type=h.isNewUser?"sign":"fast",n.rid=g.REGPageData.room_id),o.trigger("dys.login.succ",n);var a=c.getLocationParam(h.CALLBACK.login);if(a&&window.parent&&window.parent[a]){var s=window.parent[a];if(s&&e.isFunction(s))return t.client_id=h.client_id,t.passport_callback=window.passport_callback||"",void s.call(window.parent,t)}var r=window.passport_callback;setTimeout(function(){r?location.replace(r):location.reload()})},n=function(){e.dialog.tips_black(f("编码.登录过程中发生错误，请稍候再试")||"登录过程中发生错误，请稍候再试"),o.trigger("dys.login.fail",{loginType:h.view.subLoginType,step:h.step++,em:"登录过程中发生错误，请稍候再试！",fac:h.fac})};g.control.API.subSiteLogin(i.url,i,t,n)}},loginCaptcha:function(){var i=g.view.$logform,t=g.view.$voiceBtn,n=i.find(".login-by-phoneNum.login-by-sms input[name]"),a=i.find('input[name="phoneNum"]'),s={};if(y.verify&&y.verify.instance&&y.verify.instance.getResult&&(s=y.verify.instance.getResult()),!h.lock.sms&&(n.each(function(){return(flag=g.validate.check(this,"phoneCaptcha"))?void 0:!1}),flag&&g.view.checkCaptcha("sms"))){y.verify?y.verify.verifyData:{};if(y.verify&&y.verify.instance&&!(fast=y.verify.instance.getResult()))return void y.verify.instance.show();var r=e.extend(!0,{phoneNum:a.val(),areaCode:h.areaCode,lang:h.lang},g.view.getCodeVerifyParams()),l=function(i){0===+i.error?(c.countDown(t,t.val(),60),i.data&&i.data.isNotReg&&(h.isNewUser=!0,o.trigger("dys.login.notReg.showTip"),g.validate._showerr(f("编码.该手机号未注册，验证后直接注册并自动登录！")||"该手机号未注册，验证后直接注册并自动登录！","sms",2,null,1))):-1004===parseInt(i.error,10)?(y.verify.verifyData.code_token=i.data.code_token,g.view.captchaRefresh(),e.dialog.tips_black("验证码失效")):(g.view.captchaRefresh(),i.msg&&e.dialog.tips_black(i.msg)),h.lock.sms=!1},d=function(){e.dialog.tips_black("请求错误"),h.lock.sms=!1};h.lock.sms=!0,h.lock.hasSendSMS=!0,h.isNewUser=!1,g.control.API.loginVerifyPhone(r,l,d)}}},g.SubLoginType={init:function(){this.doms={loginForm:g.view.$logform,subLoginTypeBtn:e(".loginbox-login .loginbox-bd-container").find("[data-subtype]")},this.evt()},evt:function(){var i=this.doms;i.subLoginTypeBtn.on("click",function(){h.isNewUser=!1,h.view.subLoginType=e(this).data("subtype"),i.loginForm.removeClass().addClass("login-form "+h.view.subLoginType),g.view.captchaRefresh();var t=4;e(this).hasClass("login-type-enter")||(i.subLoginTypeBtn.removeClass("active"),t=3),o.trigger("dys.login.entry",{loginType:h.view.subLoginType,type:t,step:h.step++,fac:h.fac}),e(this).addClass("active"),g.validate._hideerr()})}},g.validate={check:function(o,i){var t=e(o),n=t.attr("name"),a=e.trim(t.val());if(t.attr("placeholder")||t.val(a),"geetest_challenge"===n||"geetest_validate"===n||"geetest_seccode"===n)return!0;if("captcha_word"===n&&y.verify.instance)return!0;if(""===a)return g.validate._fx_err_ipt(o),!1;var s=!0;if("login"===i)switch(h.view.subLoginType){case"login-by-nickname":"username"===n?s=g.validate._ck_login_username(o):"password"===n&&(s=g.validate._ck_login_password(o));break;case"login-by-phoneNum":"phoneNum"===n?s=g.validate._ck_phonenum(o):"password"===n&&(s=g.validate._ck_login_password(o));break;case"login-by-sms":"phoneNum"===n?s=g.validate._ck_phonenum(o):"phoneCaptcha"===n&&(s=g.validate._ck_yzphonenum(o))}else"phoneCaptcha"===i&&"phoneNum"===n&&(s=g.validate._ck_phonenum(o));return s?(g.validate._fx_rig_ipt(o),!0):!1},_showerr:function(e,o,i,t,n){g.view.loginTip({type:o,iconType:i,cont:e,isAlwaysShow:n}),g.validate._fx_err_ipt(t)},_hideerr:function(){e(".myuser-tip").empty()},_showinfo:function(e,o){g.view.errorTip({element:o,cont:e,type:"info",delay:2})},_fx_rig_ipt:function(o){e(o).removeClass("ipt-err")},_fx_err_ipt:function(o){var i=e(o),t=i,n=null;i.hasClass("ipt-err")||(i.hasClass("ipt-need-parent")&&(i.parent().addClass("ipt-parent-err"),setTimeout(function(){i.parent().removeClass("ipt-parent-err")},1500)),(i.is(":text")||i.is(":password"))&&("password"!==i.attr("name")&&"password2"!==i.attr("name")||(i.hasClass("notsub")?(t=i.prev("input"),n=i):n=i.next("input")),t.addClass("ipt-err"),n&&n.addClass("ipt-err"),i.parent().find("span.pw-span").addClass("ipt-err-span"),setTimeout(function(){t.removeClass("ipt-err"),n&&n.removeClass("ipt-err"),i.parent().find("span.pw-span").removeClass("ipt-err-span")},1500)))},_ck_login_captcha:function(o){var i=e(o).val();return 4!=i.length?(e.dialog.tips_black(f("编码.验证码不正确")||"验证码不正确"),!1):!0},_ck_phonenum:function(o){var i=e.trim(e(o).val()),t=/^[0-9]*$/.test(i);return t?!0:(e.dialog.tips_black(f("编码.手机号码不正确")||"手机号码不正确"),!1)},_ck_yzphonenum:function(o){var i=e(o).val();return 6!=i.length?(e.dialog.tips_black(f("编码.校验码格式不正确")||"校验码格式不正确"),!1):!0},_ck_login_username:function(o){var i=e(o).val();return""==i?(e.dialog.tips_black(f("编码.昵称不能为空")||"昵称不能为空"),!1):!0},_ck_login_password:function(o){var i=e(o).val(),t=i.length;return t>30?(g.validate._showerr(f("编码.密码长度不正确")||"密码长度不正确，仅限30个字符","pw",1,o),!1):!0}},v.init=function(){v.getParams(),v.completeUserInfo()},v.getParams=function(){var i,t;try{window.top&&window.top.DYS&&window.top.DYS.sub&&e.isPlainObject(window.top.DYS.sub.getDefaultFied())&&(t=window.top.DYS.sub.getDefaultFied()||{},o.trigger("dys.com.dpdata",t)),window.top&&window.top.UserJsSDK&&(i=window.top.UserJsSDK.POSSPORT||{},i&&(h.view.showParam=i.get("param","show")||{},h.view.cpsDirthName=i.get("cpsDirthName","cps")||"",h.source=h.view.showParam.source))}catch(n){}},v.completeUserInfo=function(){var o;try{g.REGPageData={room_id:0,cate_id:0,tag_id:0,child_id:0,vid:0,fac:h.source||""},window.top&&window.top.$ROOM&&(o=window.top.$ROOM,g.REGPageData.room_id=o.room_id||0,g.REGPageData.cate_id=o.category_id||0,g.REGPageData.tag_id=o.cate_id||0,g.REGPageData.child_id=o.child_id||0,g.REGPageData.vid=o.vid||0),e(".loginbox-con").find(".third-list a").attr("href",function(){var o=e(this).attr("href"),i=e.extend({},g.REGPageData);return delete i.fac,o+="&",o+=e.param(i)})}catch(i){}},y._is_init=!1,y.init=function(i){if(!y._is_init){var t=g.view.el(h.view.el.logform).find(".captcha-gt"),n=!!t.length;if(n){y._is_init=!0;var a={op_type:"23",gt_version:"v4",room_id:g.REGPageData.room_id};y.verify=new u({xhrParams:{url:"/iframe/checkGeeTest",data:a,errorHandle:function(){h.captchaLoadSucc=2}},options:{target:t,area:"#loginbox-con",v9Area:t,lang:window.$SYS&&"en"===$SYS.lang?"en":"zh-cn",shadow:{opacity:0}},success:function(){var i=y.verify.verifyData;3!==i.code_type&&1!==i.code_type||(1===h.vType?e('input[class="phone-send js-sendvoice fl"]').trigger("click"):2===h.vType&&g.view.$logform.trigger("submit")),h.captchaLoadSucc=1,o.trigger("dys.login.limitcode.succ",{loginType:h.view.subLoginType,step:h.step++,fac:h.fac})},error:function(){h.captchaLoadSucc=2,o.trigger("dys.login.limitcode.fail",{loginType:h.view.subLoginType,step:h.step++,fac:h.fac,em:"极限验证出错"})}})}}};var x={init:function(o){o=o||{},e.isFunction(o.onAuto)&&(g.control._on_auto_login=o.onAuto),g.init()},show:g.view.show,hide:g.view.hide,toggle:g.view.toggle,exitif:g.view.exitif,enter:g.view.enter,IFRAME:l,util:c};return x}),define("dypassport/com/i18n",["jquery"],function(e){var o=[];return{init:function(o){var i=this;i.language=o,e.i18n.properties({name:"translations",path:"/i18n/",mode:"map",checkAvailableLanguages:!1,language:o,cache:!0,async:!1,callback:function(){i.interprete(),i.addClass(),i.hideNoInterEl()}})},interprete:function(){var o=e("[data-i18n]");try{o.each(function(o,i){var t=e(i),n=t.html(),a=t.data("i18n"),s=e.i18n.prop(a);t.attr("title")&&t.attr("title",s),t.attr("placeholder")&&t.attr("placeholder",s);var r=t.is("h1,h2,h3,h4,h5,h6,div,p,span,a,option");r&&e.trim(n)&&t.html(s);var c=t.is("input,select,button"),l=t.val();c&&l&&!t.attr("placeholder")&&t.val(s)})}catch(i){}},addClass:function(){e("body").addClass("lang_"+this.language)},hideNoInterEl:function(){try{e.each(o,function(o,i){var t="[data-i18n='"+i+"']";e(t).addClass("hide")})}catch(i){}}}}),define("dypassport/page/login/app",["jquery","dypassport/com/user-view-login","dypassport/com/i18n"],function(e,o,i){var t={language:{en:"en_us"}};e(function(){var e=o.util.getLocationParam("type"),n=$SYS.lang;n&&"en"===n&&i.init(t.language[n]),o.init(),e?o.show(e):o.show("login")})});